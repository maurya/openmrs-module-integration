<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
         
	<changeSet id="dhis-IntegrationServer" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_integrationserver"/>
			</not>
		</preConditions>
		<comment>
			Creating the Integration server Table
		</comment>

		<createTable tableName="dhis_integrationserver">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="uuid" type="CHAR(38)">
			<constraints nullable="false"/>
			</column>
			<column name="name" type="VARCHAR(230)">
			<constraints nullable="false"/>
			</column>
			<column name="description" type="VARCHAR(230)"/>
			<column name="username" type="VARCHAR(255)">
			<constraints nullable="false"/>
			</column>
			<column name="password" type="VARCHAR(255)">
			<constraints nullable="false"/>
			</column>
			<column name="mastertemplate" type="VARCHAR(255)">
			<constraints nullable="false"/>
			</column>
			<column name="emailorurl" type="VARCHAR(255)">
			<constraints nullable="false"/>
			</column>
			<column name="transport_type" type="VARCHAR(45)">
			<constraints nullable="false"/>
			</column>
			<column name="last_updated" type="DATETIME"/>
		</createTable>
	</changeSet> 
	     
	<changeSet id="dhis-Org unit" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_orgunit"/>
			</not>
		</preConditions>
		<comment>
			Creating the org unit Table
		</comment>

		<createTable tableName="dhis_orgunit">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="uuid" type="CHAR(38)">
			<constraints nullable="false"/>
			</column>
			<column name="name" type="VARCHAR(230)">
			<constraints nullable="false"/>
			</column>
			<column name="code" type="VARCHAR(50)"/>
			<column name="uid" type="CHAR(11)"/>
			<column name="server_id" type="INT"/>
			<column name="parent_id" type="INT"/>
		</createTable>
	</changeSet> 
	
	<changeSet id="dhis-data element" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_dataelement"/>
			</not>
		</preConditions>
		<comment>
			Creating the data element Table
		</comment>

		<createTable tableName="dhis_dataelement">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="uuid" type="CHAR(38)">
			<constraints nullable="false"/>
			</column>
			<column name="name" type="VARCHAR(230)">
			<constraints nullable="false"/>
			</column>
			<column name="code" type="VARCHAR(50)">
			<constraints nullable="false"/>
			</column>
			<column name="uid" type="CHAR(11)">
			<constraints nullable="false"/>
			</column>
			<column name="type" type="VARCHAR(50)">
			<constraints nullable="false"/>
			</column>
			<column name="cohortdef_uuid" type="CHAR(38)"/>
			<column name="categorycombo_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="server_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="last_updated" type="DATETIME"/>
		</createTable>
	</changeSet> 
	
	<changeSet id="dhis-category combo" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_categorycombo"/>
			</not>
		</preConditions>
		<comment>
			Creating the category combo Table
		</comment>

		<createTable tableName="dhis_categorycombo">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="uuid" type="CHAR(38)">
			<constraints nullable="false"/>
			</column>
			<column name="name" type="VARCHAR(230)">
			<constraints nullable="false"/>
			</column>
			<column name="code" type="VARCHAR(50)">
			<constraints nullable="false"/>
			</column>
			<column name="uid" type="CHAR(11)">
			<constraints nullable="false"/>
			</column>
			<column name="server_id" type="INT">
			<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet> 
	
	<changeSet id="dhis-category option" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_categoryoption"/>
			</not>
		</preConditions>
		<comment>
			Creating the category option Table
		</comment>

		<createTable tableName="dhis_categoryoption">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="uuid" type="CHAR(38)">
			<constraints nullable="false"/>
			</column>
			<column name="name" type="VARCHAR(230)">
			<constraints nullable="false"/>
			</column>
			<column name="code" type="VARCHAR(50)">
			<constraints nullable="false"/>
			</column>
			<column name="uid" type="CHAR(11)">
			<constraints nullable="false"/>
			</column>
			<column name="server_id" type="INT">
			<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet> 
	
	<changeSet id="dhis-optionset" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_optionset"/>
			</not>
		</preConditions>
		<comment>
			Creating the optionset Table
		</comment>

		<createTable tableName="dhis_optionset">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="uuid" type="CHAR(38)">
			<constraints nullable="false"/>
			</column>
			<column name="name" type="VARCHAR(230)">
			<constraints nullable="false"/>
			</column>
			<column name="code" type="VARCHAR(50)">
			<constraints nullable="false"/>
			</column>
			<column name="uid" type="CHAR(11)">
			<constraints nullable="false"/>
			</column>
			<column name="dimension_uuid" type="CHAR(38)"/>
			<column name="server_id" type="INT">
			<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet> 
	
	<changeSet id="dhis-option" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_option"/>
			</not>
		</preConditions>
		<comment>
			Creating the option Table
		</comment>

		<createTable tableName="dhis_option">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="uuid" type="CHAR(38)">
			<constraints nullable="false"/>
			</column>
			<column name="name" type="VARCHAR(230)">
			<constraints nullable="false"/>
			</column>
			<column name="code" type="VARCHAR(50)">
			<constraints nullable="false"/>
			</column>
			<column name="uid" type="CHAR(11)">
			<constraints nullable="false"/>
			</column>
			<column name="cohortdef_uuid" type="CHAR(38)"/>
			<column name="server_id" type="INT">
			<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet> 
	
	<changeSet id="dhis-report template" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_reporttemplate"/>
			</not>
		</preConditions>
		<comment>
			Creating the report template Table
		</comment>

		<createTable tableName="dhis_reporttemplate">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="uuid" type="CHAR(38)">
			<constraints nullable="false"/>
			</column>
			<column name="name" type="VARCHAR(230)">
			<constraints nullable="false"/>
			</column>
			<column name="code" type="VARCHAR(50)">
			<constraints nullable="false"/>
			</column>
			<column name="uid" type="CHAR(11)">
			<constraints nullable="false"/>
			</column>
			<column name="frequency" type="VARCHAR(230)"/>
			<column name="report_definition_uuid" type="CHAR(38)"/>
			<column name="server_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="last_updated" type="DATETIME"/>
		</createTable>
	</changeSet> 

	<changeSet id="dhis-data value template" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_datavaluetemplate"/>
			</not>
		</preConditions>
		<comment>
			Creating the data value template Table
		</comment>

		<createTable tableName="dhis_datavaluetemplate">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="uuid" type="CHAR(38)">
			<constraints nullable="false"/>
			</column>
			<column name="dataelement_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="categoryoption_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="reporttemplate_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="server_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="last_updated" type="DATETIME"/>
		</createTable>
	</changeSet> 
	
	<changeSet id="dhis-categorycombo categoryoption" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_catcombo_combooption"/>
			</not>
		</preConditions>
		<comment>
			Creating the category combo category option link Table
		</comment>

		<createTable tableName="dhis_catcombo_combooption">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="catcombo_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="catoption_id" type="INT">
			<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet> 
	
	<changeSet id="dhis-categorycombo optionset" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_catcombo_optionset"/>
			</not>
		</preConditions>
		<comment>
			Creating the category combo optionset link Table
		</comment>

		<createTable tableName="dhis_catcombo_optionset">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="catcombo_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="optionset_id" type="INT">
			<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet> 
	
		<changeSet id="dhis-categoryoption option" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_categoryoption_option"/>
			</not>
		</preConditions>
		<comment>
			Creating the category option option link Table
		</comment>

		<createTable tableName="dhis_categoryoption_option">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="categoryoption_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="option_id" type="INT">
			<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet> 
	
		<changeSet id="dhis-optionset option" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_optionset_option"/>
			</not>
		</preConditions>
		<comment>
			Creating the optionset option link Table
		</comment>

		<createTable tableName="dhis_optionset_option">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="optionset_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="option_id" type="INT">
			<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet>
	
	<changeSet id="dhis-orgunit location" author="maurya">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="dhis_orgunit_location"/>
			</not>
		</preConditions>
		<comment>
			Creating the orgunit location link Table
		</comment>

		<createTable tableName="dhis_orgunit_location">
			<column name="id" type="INT" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>
			<column name="orgunit_id" type="INT">
			<constraints nullable="false"/>
			</column>
			<column name="location_id" type="INT">
			<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet>
	
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_orgunit">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="orgunit_serverid" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="server_id" baseTableName="dhis_orgunit" constraintName="orgunit_serverid" referencedColumnNames="id" referencedTableName="dhis_integrationserver"/>
		<addForeignKeyConstraint baseColumnNames="parent_id" baseTableName="dhis_orgunit" constraintName="orgunit_parentid" referencedColumnNames="id" referencedTableName="dhis_orgunit"/>		
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_dataelement">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="dataelement_serverid" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="server_id" baseTableName="dhis_dataelement" constraintName="dataelement_serverid" referencedColumnNames="id" referencedTableName="dhis_integrationserver"/>
		<addForeignKeyConstraint baseColumnNames="categorycombo_id" baseTableName="dhis_dataelement" constraintName="dataelement_categorycomboid" referencedColumnNames="id" referencedTableName="dhis_categorycombo"/>		
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_categorycombo">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="categorycombo_serverid" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="server_id" baseTableName="dhis_categorycombo" constraintName="categorycombo_serverid" referencedColumnNames="id" referencedTableName="dhis_integrationserver"/>
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_categoryoption">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="categoryoption_serverid" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="server_id" baseTableName="dhis_categoryoption" constraintName="categoryoption_serverid" referencedColumnNames="id" referencedTableName="dhis_integrationserver"/>
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_optionset">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="optionset_serverid" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="server_id" baseTableName="dhis_optionset" constraintName="optionset_serverid" referencedColumnNames="id" referencedTableName="dhis_integrationserver"/>
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_option">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="option_serverid" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="server_id" baseTableName="dhis_option" constraintName="option_serverid" referencedColumnNames="id" referencedTableName="dhis_integrationserver"/>
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_reporttemplate">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="reporttemplate_serverid" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="server_id" baseTableName="dhis_reporttemplate" constraintName="reporttemplate_serverid" referencedColumnNames="id" referencedTableName="dhis_integrationserver"/>
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_datavaluetemplate">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="datavaluetemplate_serverid" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="server_id" baseTableName="dhis_datavaluetemplate" constraintName="datavaluetemplate_serverid" referencedColumnNames="id" referencedTableName="dhis_integrationserver"/>
		<addForeignKeyConstraint baseColumnNames="dataelement_id" baseTableName="dhis_datavaluetemplate" constraintName="datavaluetemplate_dataelement" referencedColumnNames="id" referencedTableName="dhis_dataelement"/>	
		<addForeignKeyConstraint baseColumnNames="categoryoption_id" baseTableName="dhis_datavaluetemplate" constraintName="datavaluetemplate_categoryoption" referencedColumnNames="id" referencedTableName="dhis_categoryoption"/>
		<addForeignKeyConstraint baseColumnNames="reporttemplate_id" baseTableName="dhis_datavaluetemplate" constraintName="datavaluetemplate_reporttemplate" referencedColumnNames="id" referencedTableName="dhis_reporttemplate"/>	
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_catcombo_combooption">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="catcombo_combooption_categorycombo" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="catcombo_id" baseTableName="dhis_catcombo_combooption" constraintName="catcombo_combooption_categorycombo" referencedColumnNames="id" referencedTableName="dhis_categorycombo"/>
		<addForeignKeyConstraint baseColumnNames="catoption_id" baseTableName="dhis_catcombo_combooption" constraintName="catcombo_combooption_categoryoption" referencedColumnNames="id" referencedTableName="dhis_categoryoption"/>	
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_catcombo_optionset">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="catcombo_optionset_categorycombo" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="catcombo_id" baseTableName="dhis_catcombo_optionset" constraintName="catcombo_optionset_categorycombo" referencedColumnNames="id" referencedTableName="dhis_categorycombo"/>
		<addForeignKeyConstraint baseColumnNames="optionset_id" baseTableName="dhis_catcombo_optionset" constraintName="catcombo_combooption_optionset" referencedColumnNames="id" referencedTableName="dhis_optionset"/>	
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_categoryoption_option">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="categoryoption_option_categoryoption" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="categoryoption_id" baseTableName="dhis_categoryoption_option" constraintName="categoryoption_option_categoryoption" referencedColumnNames="id" referencedTableName="dhis_categoryoption"/>
		<addForeignKeyConstraint baseColumnNames="option_id" baseTableName="dhis_categoryoption_option" constraintName="categoryoption_option_option" referencedColumnNames="id" referencedTableName="dhis_option"/>	
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_optionset_option">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="optionset_option_optionset" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="optionset_id" baseTableName="dhis_optionset_option" constraintName="optionset_option_optionset" referencedColumnNames="id" referencedTableName="dhis_optionset"/>
		<addForeignKeyConstraint baseColumnNames="option_id" baseTableName="dhis_optionset_option" constraintName="optionset_option_option" referencedColumnNames="id" referencedTableName="dhis_option"/>	
	</changeSet>
	
	<changeSet author="maurya" id="foreign_key_constraints-dhis_orgunit_location">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="orgunit_location_orgunit" />
			</not>
		</preConditions>
		<addForeignKeyConstraint baseColumnNames="orgunit_id" baseTableName="dhis_orgunit_location" constraintName="orgunit_location_orgunit" referencedColumnNames="id" referencedTableName="dhis_orgunit"/>
		<addForeignKeyConstraint baseColumnNames="location_id" baseTableName="dhis_orgunit_location" constraintName="orgunit_location_location" referencedColumnNames="id" referencedTableName="location"/>	
	</changeSet>
	
</databaseChangeLog>